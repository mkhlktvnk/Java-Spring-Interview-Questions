## Какие есть виды сканирования в PostgreSQL?
1. Sequence Scan.
2. Index Scan.
3. Bitmap Index Scan.
4. Index Only Scan.

## Что такое Sequence Scan?
При Sequence Scan происходит обход всей таблицы в том порядке, в котором она записана на диске.

## Что такое Index Scan?
При index-scan происходит обход индекса, поиск узлов с необходимыми ключами и обращение к таблице за данными.

## Что такое Bitmap Index Scan?
Bitmap Scan сканирует индекс по определенному условию, после чего строит битовую карту на основе найденных данных.
В битовой карте указаны те страницы файла, которые необходимо заново просканировать, чтобы извлечь нужные по фильтрации данные.
После построения битовой карты происходит повторное сканирование этих страниц с дополнительной проверкой условия.

## Какими способами происходят JOIN в PostgreSQL?
1. Nested Loop
2. Hash Join
3. Merge Join

## Что такое Nested Loop?
Nested Loop (вложенный цикл) сканирует одну таблицу и циклом выбирает соответствующие данные из другой таблицы.
Применяется планировщиком на небольшом объеме данных для JOIN.

## Что такое Hash Join?
При Hash Join данные из одной таблицы загружаются в Hash-Map, после чего происходит обход второй таблицы и нахождение соответствий для нее с использованием данных из уже созданной хэш-таблицы.
Применяется планировщиком на больших объемах данных для Join.

## Что такое Merge Join?
Merge join требует того, чтобы ключи первой и второй таблицы при JOIN были предварительно отсортированы или имели индексы.
При Merge Join происходит обход двух отсортированных последовательностей и нахождение соответствий между ними.
Это самый быстрый вид Join.

## Какими способами может происходить сортировка в PostgreSQL?
1. In-memory Sort
2. External Sort

## Что такое In-memory Sort?
In-memory Sort - сортировка, которая происходит в памяти. Данные считываются в RAM, где и происходит их сортировка.

## Что такое External Sort?
External Sort - сортировка, которую применяет планировщик в случае, когда данные не помещаюься в RAM.
Данные разбиваются на более мелкие части, которые могут поместится в RAM, после чего они сортируются и на последнем этапе происходит слияние.

## Какими способами может происходить агрегирование в PostgreSQL?
1. Hash Aggregate
2. Sort Aggregate
3. Index Aggregate
4. Bitmap Aggregate
5. Group Aggregate

## Что такое Hash Aggregate?
Это вид агрегации, который использует Hash-Map. Он группирует данные по ключу агрегации, затем каждая группа агрегируется в отдельности и происходит объединение всех групп.

## Что такое Sort Aggregate?
Это вид агрегации, при котором данные сначала сортируются по ключу агрегации, а потом происходит сканирование данных и агрегация по отсортированным группам.

## Что такое Bitmap Aggregate?
Это вид агрегации, который использует битовую карту. Чаще всего применяется планировщиком, когда используются операторы AND или OR.

## Что такое Index Aggregate?
Если существуют подходящие индексы для группировочных ключей и агрегирующих функций, PostgreSQL может использовать индексы для выполнения агрегации, избегая полного сканирования таблицы.

## Что такое Group Aggregate?
В этом методе данные группируются в памяти на основе значения ключа агрегации, а затем агрегируются в каждой группе.

## Какие есть виды индексов в PostgreSQL?
1. B-tree (default index) - сбалансированное дерево поиска
2. Hash-index
3. Gist - обобщенное дерево поиска
4. Gin - обобщённый обратный индекс
5. SP-Gist - Gist с двоичным разделением пространства
6. BRin - блочно-диапазонный

## Расскжаите про B-tree index
B-tree index - это структура данных, которая представляет из себя сбалансированное дерево. 
Он обеспечивает O(log(n)) время доступа.

- B-tree индекс создается по умолчанию при создании индекса, а также при использовании PRIMARY KEY & UNIQUE constraint.
- Поддерживает операторы >, <, >=, <=, =
- Поддерживает `LIKE 'abc%'`, но не `LIKE '%abc'`
- Индексирует NULL
- Сложность поиска O(log(n))

## Расскажите про Hash-index
Хэш-индекс хранит 32-битное значение хэша индексируемого столбца и индексируемый столбец (Hash-map).
Этот вид индексов поддерживает только операцию сравнения (=).
Планировщик запросов выберет для использования хэш индекс только тогда, когда индексируемый столбец будет фильтроваться только используя операцию строгого сравнения (=).

- поддерживает только оператор строго сравнения
- применяется планировщиком только при сравнению по строгому равенству
- не отражается в журнале предзаписи WAL
- Сложность поиска O(1)

## Расскажите про Gist-index
Представляет из себя R-tree - обычное упорядоченное дерево, которое позволяет задать способ распределения данных на основе собственного сравнения.
Применяется для индексации сложных данных (геометрических, пространственных и т.д.)
Например, с помощью Gist можно производить индексацию по пространственных данных, которые могут сравниваться по взаимному расположению (Находится слева, находится справа и т.д.)

- Gist-index представляет из себя сбалансированное дерево, которое состоит из узлов-страниц.
- Каждый узел состоит из индексных записей.
- Каждая запись листового узла содержит внутри себя предикат (некоторое логическое выражение для сравнения) и ссылку на индексируемые данные, которые должны соответствовать этому предикату.
- Каждая запись дочернего узла также содержит внутре себя предикат и ссылку на дочерний узел, причем все данные дочернего поддерева должны соответствовать этому предикату.
- Поиск по Gist-индексу происходит по функции согласованности - функция, которая определяет общий интерфейс для сравнения и реализуется различным способом для разных данных.
- При вставке нового значения в Gist для него выбирается такая родительская запись, предикат которой приходится не расширять вовсе или расширять минимально.
- При удалении значения из Gist предикат родительской записи не сужается, это происходит только при полном перестроении индекса (reindex или vacuum full)
- Применяется для хранения точек (геометрия, геоданные), интервалов и полнотекстового поиска
- Сложность доступа O(log(n))

## Расскажите про SP-Gist индекс
Метод доступа SP-Gist предполагает разбиение некоторой области значений на неперекрывающиеся интервалы, которые также могут быть разбиты.
Может быть реализован с помощью дерева квадратантов, k-мерных деревьев и префиксных деревьев.

- SP-Gist представляет из себя несбалансированное дерево.
- Внутренний узел хранит в себе ссылки на дочерние узлы, для каждой ссылки может быть задана метка, таже может хранить префикс для дочернего узла, который зачастую является предикатом
- Листовые узлы содержат индексируемые данные и ссылку на строку, листовые узлы могут объединяться в списки
- Использует для поиска функцию согласованности
- Имеет небольшое ветвение и из-за этого используется в оперативной памяти, а не на диске

## Расскажите про Gin индекс
Gin-индекс представляет из себя структуру данных ключ-значение, которая в качестве ключа используется какой-то элемент, а в качестве значения - записи, в которых этот элемент встречается.
Можно провести аналог с алфавитным указателем в конце книги, где термин и список страниц, на которых он встречается.

- хранится в виде B-tree
- к каждому элементу привязан набор ссылок на записи в таблице, в которых этот элемент встречается.
- используется для полнотекстового поиска

## Какие уровни изоляции транзакций поддерживаются PostgreSQL?
1. Read Uncommitted
2. Read Committed
3. Repeatable read
4. Serializable

Однако, внутренне в PostgreSQL реализованы только три уровня: Read Committed является дефолтным уровнем изоляции и при Read Uncommitted устанавливается этот уровень.
